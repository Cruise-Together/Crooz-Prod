(this["webpackJsonp@crooz/client"]=this["webpackJsonp@crooz/client"]||[]).push([[0],{113:function(e,t,n){},114:function(e,t,n){},117:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),c=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),c(n(118),t)},118:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.joinRoom=t.ClientActionType=void 0;var r,c=n(54);!function(e){e.joinRoom="@client/joinRoom"}(r=t.ClientActionType||(t.ClientActionType={})),t.joinRoom=c.createAction(r.joinRoom)()},119:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},188:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),o=n(45),a=n.n(o),i=(n(113),n(205)),u=n(200),s=n(207),l=n(201),d=(n(114),n(106)),p=n(203),f=n(202),j=n(3),b=n.n(j),v=n(18),O=n(30),m=n(19),h=n(95),x=n(66),g=n(54),y=n(97),C=n(96),k=n.n(C),w=n(2),S=c.a.createContext(null),R=function(e){var t=e.children,n=Object(r.useRef)(new h.Client("wss://".concat("room-server.crooz.in"))),c=Object(r.useState)(""),o=Object(m.a)(c,2),a=o[0],i=o[1],u=Object(r.useState)(!1),s=Object(m.a)(u,2),l=s[0],d=s[1],p=Object(r.useState)(null),f=Object(m.a)(p,2),j=f[0],y=f[1],C=Object(r.useState)(null),R=Object(m.a)(C,2),P=R[0],_=R[1],I=Object(r.useState)(""),M=Object(m.a)(I,2),T=M[0],E=M[1];Object(r.useEffect)((function(){j&&(i(j.state.roomCode),j.send(Object(g.getType)(x.joinRoom),Object(x.joinRoom)({username:T}).payload))}),[j,T,null===j||void 0===j?void 0:j.state.roomCode]);var J=function(e){e.onStateChange((function(e){_(Object(O.a)({},e))})),y(e)},A=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,j&&j.leave(),e.next=6,k.a.get("https://".concat("room-server.crooz.in","/rooms?roomCode=").concat(a));case 6:return t=e.sent,e.t0=J,e.next=10,n.current.joinById(t.data);case 10:e.t1=e.sent,(0,e.t0)(e.t1),d(!0),e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),d(!1);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,j&&j.leave(),e.next=4,n.current.create("CroozRoom");case 4:t=e.sent,J(t),d(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),d(!1);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),z={client:n.current,roomCode:a,setRoomCode:i,joinRoom:A,createRoom:N,connected:l,room:j,username:T,setUsername:E,roomState:P};return Object(w.jsx)(S.Provider,{value:z,children:t})},P=function(){var e=Object(r.useContext)(S);return Object(y.a)(e,"no context provide for colyseus"),e},_=function(){var e=P(),t=e.roomCode,n=e.setRoomCode,r=e.joinRoom,c=e.createRoom,o=e.username,a=e.setUsername;return Object(w.jsxs)(d.a,{children:[Object(w.jsx)(d.a,{margin:{bottom:"small"},children:Object(w.jsx)(p.a,{placeholder:"Room Code",value:t,onChange:function(e){return n(e.target.value)}})}),Object(w.jsx)(d.a,{margin:{bottom:"small"},children:Object(w.jsx)(p.a,{placeholder:"Username",value:o,onChange:function(e){return a(e.target.value)}})}),Object(w.jsx)(d.a,{children:Object(w.jsxs)("div",{children:[Object(w.jsx)(f.a,{primary:!0,label:"Join Cruise",margin:"small",onClick:function(){r()}}),Object(w.jsx)(f.a,{primary:!0,margin:"small",label:"Create Cruise",onClick:function(){c()}})]})})]})},I=n(105),M=n(104),T=n(206),E=n(102),J=n(103),A=c.a.createContext(null),N=function(e){var t=e.children,n=e.serverReceiveId,c=e.room,o=e.microphone,a=Object(r.useRef)(new J.Device),i=Object(r.useRef)(null),u=Object(r.useRef)(null),s=Object(r.useRef)(new Map),l=Object(r.useState)(null),d=Object(m.a)(l,2),p=d[0],f=d[1],j=Object(r.useState)(null),h=Object(m.a)(j,2),x=h[0],g=h[1];return Object(r.useEffect)((function(){null===c||void 0===c||c.onMessage("transport-config",function(){var e=Object(v.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g(JSON.parse(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[c]),Object(r.useEffect)((function(){null===c||void 0===c||c.onMessage("create-consumer",function(){var e=Object(v.a)(b.a.mark((function e(t){var n,r,o,a,u,l,d,p;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=JSON.parse(t)).clientId===c.sessionId){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,null===(n=i.current)||void 0===n?void 0:n.consume(r);case 5:if(o=e.sent){s.current.set(r.producerId,o),console.log("Receive valid consumer",o),a=o.track,(u=document.createElement("audio")).autoplay=!0,u.srcObject=new MediaStream([a]),console.log("number of consumers",s.current.size,u.srcObject.getAudioTracks().length,"producer is client: ",r.producerId),l=Object(E.a)(u.srcObject.getAudioTracks());try{for(l.s();!(d=l.n()).done;)p=d.value,console.log(p)}catch(f){l.e(f)}finally{l.f()}}case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[c]),Object(r.useEffect)((function(){c.onMessage("transport-ids",(function(e){f(JSON.parse(e))})),null===c||void 0===c||c.send("mediaSoupJoin","")}),[c]),Object(r.useEffect)((function(){c.onStateChange((function(e){s.current.forEach((function(t,n){e.drivers.has(n)||s.current.delete(n)}))}))})),Object(r.useEffect)((function(){x&&p&&function(){var e=Object(v.a)(b.a.mark((function e(t){var n,r,s,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.producer,r=t.consumer,s=Object(O.a)(Object(O.a)({},n),{},{id:(null===p||void 0===p?void 0:p.producer)||""}),l=Object(O.a)(Object(O.a)({},r),{},{id:(null===p||void 0===p?void 0:p.consumer)||""}),a.current.loaded){e.next=9;break}return e.next=6,a.current.load({routerRtpCapabilities:n.rtpCapabilities});case 6:c.send("device-rtp-capabilities",JSON.stringify(a.current.rtpCapabilities)),e.next=10;break;case 9:return e.abrupt("return");case 10:return u.current=a.current.createSendTransport(s),i.current=a.current.createRecvTransport(l),u.current.on("connect",function(){var e=Object(v.a)(b.a.mark((function e(t,n,r){var o,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.dtlsParameters,console.log("Connected send transport"),e.prev=2,e.next=5,c.send("producer-transport-connect",JSON.stringify({transportId:null===(a=u.current)||void 0===a?void 0:a.id,dtlsParameters:o}));case 5:n(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),r(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n,r){return e.apply(this,arguments)}}()),i.current.on("connect",function(){var e=Object(v.a)(b.a.mark((function e(t,n,r){var o,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.dtlsParameters,console.log("Connected receive transport"),e.prev=2,e.next=5,c.send("consumer-transport-connect",JSON.stringify({transportId:null===(a=i.current)||void 0===a?void 0:a.id,dtlsParameters:o}));case 5:n(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),r(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n,r){return e.apply(this,arguments)}}()),u.current.on("produce",function(){var e=Object(v.a)(b.a.mark((function e(t,n,r){var o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("producing"),c.onMessage("producerId",(function(e){n({id:e})})),e.next=4,c.send("create-producer",JSON.stringify({transportId:null===(o=u.current)||void 0===o?void 0:o.id,kind:t.kind,rtpParameters:t.rtpParameters,appData:t.appData}));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),e.next=17,u.current.produce({track:o});case 17:console.log("producer created");case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(x)}),[c,n,o,x,p]),Object(w.jsx)(A.Provider,{value:null,children:t})},z=function(){var e=P(),t=e.roomCode,n=e.room,c=e.roomState,o=Object(r.useMemo)((function(){return c?Array.from(c.drivers).map((function(e){var t=Object(m.a)(e,2),n=t[0],r=t[1];return Object(w.jsx)(T.a,{children:r.username},n)})):[]}),[c]),a=Object(r.useState)(null),i=Object(m.a)(a,2),u=i[0],l=i[1];return Object(r.useEffect)((function(){(function(){var e=Object(v.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:t=e.sent,n=t.getTracks()[0],l(n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),u&&n&&Object(w.jsxs)(N,{room:n,serverReceiveId:(null===c||void 0===c?void 0:c.receiveTransportId)||"",microphone:u,children:[Object(w.jsxs)(d.a,{pad:"none",align:"start",children:[Object(w.jsxs)(s.a,{level:"3",children:["You are connected to ",t]}),Object(w.jsx)(s.a,{level:"4",children:"Drivers"}),o]}),Object(w.jsx)("audio",{id:"remoteAudio",autoPlay:!0,playsInline:!0})]})},D=Object(M.deepMerge)(I.grommet,{global:{colors:{brand:"#EFC929"}}});var B=function(){var e=P(),t=e.connected,n=e.room;return Object(w.jsx)("div",{className:"App",children:t&&n?Object(w.jsx)(z,{}):Object(w.jsx)(_,{})})},F=function(){return Object(w.jsx)(i.a,{theme:D,children:Object(w.jsxs)(R,{children:[Object(w.jsx)(u.a,{background:"light-4",pad:{left:"medium"},children:Object(w.jsx)(s.a,{children:"Crooz"})}),Object(w.jsx)(l.a,{pad:"medium",children:Object(w.jsx)(B,{})})]})})},U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,208)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),r(e),c(e),o(e),a(e)}))};a.a.render(Object(w.jsx)(c.a.StrictMode,{children:Object(w.jsx)(F,{})}),document.getElementById("root")),U()},66:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),c=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),c(n(117),t),c(n(119),t)}},[[188,1,2]]]);
//# sourceMappingURL=main.7cb8f44f.chunk.js.map