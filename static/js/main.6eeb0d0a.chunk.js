(this["webpackJsonp@crooz/client"]=this["webpackJsonp@crooz/client"]||[]).push([[0],{157:function(e,t,r){"use strict";r.r(t);var n,c=r(0),a=r.n(c),o=r(38),u=r.n(o),s=(r(97),r(2)),i=r.n(s),d=r(19),l=r(18),p=(r(99),r(171)),f=r(169),j=r(28),v=r(73),b=r(39);!function(e){e.joinRoom="@client/joinRoom"}(n||(n={}));var O=Object(b.createAction)(n.joinRoom)(),m=r(75),h=r(74),x=r.n(h),g=r(4),k=a.a.createContext(null),w=function(e){var t=e.children,r=Object(c.useRef)(new v.Client("ws://".concat("room-server.crooz.in",":2567"))),n=Object(c.useState)(""),a=Object(l.a)(n,2),o=a[0],u=a[1],s=Object(c.useState)(!1),p=Object(l.a)(s,2),f=p[0],m=p[1],h=Object(c.useState)(null),w=Object(l.a)(h,2),y=w[0],C=w[1],S=Object(c.useState)(null),R=Object(l.a)(S,2),I=R[0],J=R[1],E=Object(c.useState)(""),P=Object(l.a)(E,2),M=P[0],N=P[1],T=Object(c.useState)(""),z=Object(l.a)(T,2),A=z[0];z[1];Object(c.useEffect)((function(){y&&(u(y.id),y.send(Object(b.getType)(O),O({username:M}).payload))}),[y,M]);var D=function(e){e.onStateChange((function(e){J(Object(j.a)({},e))})),C(e)},F=function(){var e=Object(d.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,y&&y.leave(),e.next=6,x.a.get("http://".concat("room-server.crooz.in",":2567/rooms?roomCode=").concat(o));case 6:return t=e.sent,e.t0=D,e.next=10,r.current.joinById(t.data);case 10:e.t1=e.sent,(0,e.t0)(e.t1),m(!0),e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),m(!1);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(d.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y&&y.leave(),e.next=4,r.current.create("CroozRoom");case 4:t=e.sent,D(t),m(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),m(!1);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),U={client:r.current,roomCode:o,setRoomCode:u,joinRoom:F,createRoom:B,connected:f,room:y,username:M,setUsername:N,roomState:I,serverReceiveId:A};return Object(g.jsx)(k.Provider,{value:U,children:t})},y=function(){var e=Object(c.useContext)(k);return Object(m.a)(e,"no context provide for colyseus"),e},C=function(){var e=y(),t=e.roomCode,r=e.setRoomCode,n=e.joinRoom,c=e.createRoom,a=e.username,o=e.setUsername;return Object(g.jsxs)("div",{children:[Object(g.jsx)(p.a,{placeholder:"Room Code",value:t,onChange:function(e){return r(e.target.value)}}),Object(g.jsx)(p.a,{placeholder:"Username",value:a,onChange:function(e){return o(e.target.value)}}),Object(g.jsx)(f.a,{primary:!0,label:"Join Cruise",onClick:function(){n()}}),Object(g.jsx)(f.a,{primary:!0,label:"Create Cruise",onClick:function(){c()}})]})},S=r(91),R=a.a.createContext(null),I=function(e){var t=e.children,r=e.serverReceiveId,n=e.room,a=e.microphone,o=Object(c.useRef)(new S.Device),u=Object(c.useRef)(null),s=Object(c.useRef)(null),p=Object(c.useRef)(new Map),f=Object(c.useState)(null),v=Object(l.a)(f,2),b=v[0],O=v[1],m=Object(c.useState)(null),h=Object(l.a)(m,2),x=h[0],k=h[1];return Object(c.useEffect)((function(){null===n||void 0===n||n.onMessage("transport-config",function(){var e=Object(d.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(JSON.parse(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[n]),Object(c.useEffect)((function(){null===n||void 0===n||n.onMessage("create-consumer",function(){var e=Object(d.a)(i.a.mark((function e(t){var r,c,a,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((c=JSON.parse(t)).clientId===n.sessionId){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,null===(r=u.current)||void 0===r?void 0:r.consume(c);case 5:(a=e.sent)&&(o=a.track,(s=document.getElementById("remoteAudio"))&&(s.srcObject?s.srcObject.addTrack(o):s.srcObject=new MediaStream([o])));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[n]),Object(c.useEffect)((function(){n.onMessage("transport-ids",(function(e){O(JSON.parse(e))})),null===n||void 0===n||n.send("mediaSoupJoin","")}),[n]),Object(c.useEffect)((function(){n.onStateChange((function(e){e.drivers.forEach((function(e,t){t!==n.sessionId&&console.log("new driver detected",t)})),p.current.forEach((function(t,r){e.drivers.has(r)||p.current.delete(r)}))}))})),Object(c.useEffect)((function(){x&&b&&function(){var e=Object(d.a)(i.a.mark((function e(t){var r,c,l,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.producer,c=t.consumer,l=Object(j.a)(Object(j.a)({},r),{},{id:(null===b||void 0===b?void 0:b.producer)||""}),p=Object(j.a)(Object(j.a)({},c),{},{id:(null===b||void 0===b?void 0:b.consumer)||""}),o.current.loaded){e.next=9;break}return e.next=6,o.current.load({routerRtpCapabilities:r.rtpCapabilities});case 6:n.send("device-rtp-capabilities",JSON.stringify(o.current.rtpCapabilities)),e.next=10;break;case 9:return e.abrupt("return");case 10:return s.current=o.current.createSendTransport(l),u.current=o.current.createRecvTransport(p),s.current.on("connect",function(){var e=Object(d.a)(i.a.mark((function e(t,r,c){var a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.dtlsParameters,e.prev=1,e.next=4,n.send("producer-transport-connect",JSON.stringify({transportId:null===(o=s.current)||void 0===o?void 0:o.id,dtlsParameters:a}));case 4:r(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),c(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r,n){return e.apply(this,arguments)}}()),u.current.on("connect",function(){var e=Object(d.a)(i.a.mark((function e(t,r,c){var a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.dtlsParameters,e.prev=1,e.next=4,n.send("consumer-transport-connect",JSON.stringify({transportId:null===(o=u.current)||void 0===o?void 0:o.id,dtlsParameters:a}));case 4:r(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),c(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r,n){return e.apply(this,arguments)}}()),s.current.on("produce",function(){var e=Object(d.a)(i.a.mark((function e(t,r,c){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.onMessage("producerId",(function(e){r({id:e})})),e.next=3,n.send("create-producer",JSON.stringify({transportId:null===(a=s.current)||void 0===a?void 0:a.id,kind:t.kind,rtpParameters:t.rtpParameters,appData:t.appData}));case 3:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()),e.next=17,s.current.produce({track:a});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(x)}),[n,r,a,x,b]),Object(g.jsx)(R.Provider,{value:null,children:t})};var J=function(){var e=y(),t=e.connected,r=e.roomCode,n=e.room,a=e.roomState,o=Object(c.useMemo)((function(){return a?Array.from(a.drivers).map((function(e){var t=Object(l.a)(e,2),r=t[0],n=t[1];return Object(g.jsx)("div",{children:n.username},r)})):[]}),[a]),u=Object(c.useState)(null),s=Object(l.a)(u,2),p=s[0],f=s[1];return Object(c.useEffect)((function(){(function(){var e=Object(d.a)(i.a.mark((function e(){var t,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:t=e.sent,r=t.getTracks()[0],f(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(g.jsx)(g.Fragment,{children:p&&Object(g.jsx)("div",{className:"App",children:t&&n?Object(g.jsxs)(I,{room:n,serverReceiveId:(null===a||void 0===a?void 0:a.receiveTransportId)||"",microphone:p,children:[Object(g.jsx)("h1",{children:"create offer"}),Object(g.jsxs)("div",{children:["you are connected to ",r," with state:"]}),Object(g.jsxs)("pre",{children:[JSON.stringify(null===n||void 0===n?void 0:n.state,void 0,2),"`"]}),Object(g.jsxs)("div",{children:["drivers: ",o]}),Object(g.jsx)("audio",{id:"remoteAudio",autoPlay:!0,playsInline:!0})]}):Object(g.jsx)(C,{})})})},E=function(){return Object(g.jsxs)(w,{children:[Object(g.jsx)("h1",{children:"you are in the app"}),Object(g.jsx)(J,{})]})},P=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,173)).then((function(t){var r=t.getCLS,n=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;r(e),n(e),c(e),a(e),o(e)}))};u.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(E,{})}),document.getElementById("root")),P()},97:function(e,t,r){},99:function(e,t,r){}},[[157,1,2]]]);
//# sourceMappingURL=main.6eeb0d0a.chunk.js.map