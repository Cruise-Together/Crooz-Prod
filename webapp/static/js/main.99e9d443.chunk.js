(this["webpackJsonp@crooz/client"]=this["webpackJsonp@crooz/client"]||[]).push([[0],{157:function(e,t,n){"use strict";n.r(t);var r,c=n(0),a=n.n(c),o=n(38),u=n.n(o),s=(n(97),n(2)),i=n.n(s),d=n(19),l=n(18),p=(n(99),n(171)),f=n(169),j=n(28),v=n(73),b=n(39);!function(e){e.joinRoom="@client/joinRoom"}(r||(r={}));var O=Object(b.createAction)(r.joinRoom)(),m=n(75),h=n(74),x=n.n(h),g=n(4),k=a.a.createContext(null),w=function(e){var t=e.children,n=Object(c.useRef)(new v.Client("ws://".concat("3.24.134.37",":2567"))),r=Object(c.useState)(""),a=Object(l.a)(r,2),o=a[0],u=a[1],s=Object(c.useState)(!1),p=Object(l.a)(s,2),f=p[0],m=p[1],h=Object(c.useState)(null),w=Object(l.a)(h,2),y=w[0],C=w[1],S=Object(c.useState)(null),R=Object(l.a)(S,2),I=R[0],J=R[1],E=Object(c.useState)(""),P=Object(l.a)(E,2),M=P[0],N=P[1],T=Object(c.useState)(""),A=Object(l.a)(T,2),D=A[0];A[1];Object(c.useEffect)((function(){y&&(u(y.id),y.send(Object(b.getType)(O),O({username:M}).payload))}),[y,M]);var F=function(e){e.onStateChange((function(e){J(Object(j.a)({},e))})),C(e)},B=function(){var e=Object(d.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,y&&y.leave(),e.next=6,x.a.get("http://".concat("3.24.134.37",":2567/rooms?roomCode=").concat(o));case 6:return t=e.sent,e.t0=F,e.next=10,n.current.joinById(t.data);case 10:e.t1=e.sent,(0,e.t0)(e.t1),m(!0),e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),m(!1);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(d.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y&&y.leave(),e.next=4,n.current.create("CroozRoom");case 4:t=e.sent,F(t),m(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),m(!1);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),z={client:n.current,roomCode:o,setRoomCode:u,joinRoom:B,createRoom:U,connected:f,room:y,username:M,setUsername:N,roomState:I,serverReceiveId:D};return Object(g.jsx)(k.Provider,{value:z,children:t})},y=function(){var e=Object(c.useContext)(k);return Object(m.a)(e,"no context provide for colyseus"),e},C=function(){var e=y(),t=e.roomCode,n=e.setRoomCode,r=e.joinRoom,c=e.createRoom,a=e.username,o=e.setUsername;return Object(g.jsxs)("div",{children:[Object(g.jsx)(p.a,{placeholder:"Room Code",value:t,onChange:function(e){return n(e.target.value)}}),Object(g.jsx)(p.a,{placeholder:"Username",value:a,onChange:function(e){return o(e.target.value)}}),Object(g.jsx)(f.a,{primary:!0,label:"Join Cruise",onClick:function(){r()}}),Object(g.jsx)(f.a,{primary:!0,label:"Create Cruise",onClick:function(){c()}})]})},S=n(91),R=a.a.createContext(null),I=function(e){var t=e.children,n=e.serverReceiveId,r=e.room,a=e.microphone,o=Object(c.useRef)(new S.Device),u=Object(c.useRef)(null),s=Object(c.useRef)(null),p=Object(c.useRef)(new Map),f=Object(c.useState)(null),v=Object(l.a)(f,2),b=v[0],O=v[1],m=Object(c.useState)(null),h=Object(l.a)(m,2),x=h[0],k=h[1];return Object(c.useEffect)((function(){null===r||void 0===r||r.onMessage("transport-config",function(){var e=Object(d.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(JSON.parse(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[r]),Object(c.useEffect)((function(){null===r||void 0===r||r.onMessage("create-consumer",function(){var e=Object(d.a)(i.a.mark((function e(t){var n,c,a,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((c=JSON.parse(t)).clientId===r.sessionId){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,null===(n=u.current)||void 0===n?void 0:n.consume(c);case 5:(a=e.sent)&&(o=a.track,(s=document.getElementById("remoteAudio"))&&(s.srcObject?s.srcObject.addTrack(o):s.srcObject=new MediaStream([o])));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[r]),Object(c.useEffect)((function(){r.onMessage("transport-ids",(function(e){O(JSON.parse(e))})),null===r||void 0===r||r.send("mediaSoupJoin","")}),[r]),Object(c.useEffect)((function(){r.onStateChange((function(e){e.drivers.forEach((function(e,t){t!==r.sessionId&&console.log("new driver detected",t)})),p.current.forEach((function(t,n){e.drivers.has(n)||p.current.delete(n)}))}))})),Object(c.useEffect)((function(){x&&b&&function(){var e=Object(d.a)(i.a.mark((function e(t){var n,c,l,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.producer,c=t.consumer,l=Object(j.a)(Object(j.a)({},n),{},{id:(null===b||void 0===b?void 0:b.producer)||""}),p=Object(j.a)(Object(j.a)({},c),{},{id:(null===b||void 0===b?void 0:b.consumer)||""}),o.current.loaded){e.next=9;break}return e.next=6,o.current.load({routerRtpCapabilities:n.rtpCapabilities});case 6:r.send("device-rtp-capabilities",JSON.stringify(o.current.rtpCapabilities)),e.next=10;break;case 9:return e.abrupt("return");case 10:return s.current=o.current.createSendTransport(l),u.current=o.current.createRecvTransport(p),s.current.on("connect",function(){var e=Object(d.a)(i.a.mark((function e(t,n,c){var a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.dtlsParameters,e.prev=1,e.next=4,r.send("producer-transport-connect",JSON.stringify({transportId:null===(o=s.current)||void 0===o?void 0:o.id,dtlsParameters:a}));case 4:n(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),c(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()),u.current.on("connect",function(){var e=Object(d.a)(i.a.mark((function e(t,n,c){var a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.dtlsParameters,e.prev=1,e.next=4,r.send("consumer-transport-connect",JSON.stringify({transportId:null===(o=u.current)||void 0===o?void 0:o.id,dtlsParameters:a}));case 4:n(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),c(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()),s.current.on("produce",function(){var e=Object(d.a)(i.a.mark((function e(t,n,c){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.onMessage("producerId",(function(e){n({id:e})})),e.next=3,r.send("create-producer",JSON.stringify({transportId:null===(a=s.current)||void 0===a?void 0:a.id,kind:t.kind,rtpParameters:t.rtpParameters,appData:t.appData}));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),e.next=17,s.current.produce({track:a});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(x)}),[r,n,a,x,b]),Object(g.jsx)(R.Provider,{value:null,children:t})};var J=function(){var e=y(),t=e.connected,n=e.roomCode,r=e.room,a=e.roomState,o=Object(c.useMemo)((function(){return a?Array.from(a.drivers).map((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1];return Object(g.jsx)("div",{children:r.username},n)})):[]}),[a]),u=Object(c.useState)(null),s=Object(l.a)(u,2),p=s[0],f=s[1];return Object(c.useEffect)((function(){(function(){var e=Object(d.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:t=e.sent,n=t.getTracks()[0],f(n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(g.jsx)(g.Fragment,{children:p&&Object(g.jsx)("div",{className:"App",children:t&&r?Object(g.jsxs)(I,{room:r,serverReceiveId:(null===a||void 0===a?void 0:a.receiveTransportId)||"",microphone:p,children:[Object(g.jsx)("h1",{children:"create offer"}),Object(g.jsxs)("div",{children:["you are connected to ",n," with state:"]}),Object(g.jsxs)("pre",{children:[JSON.stringify(null===r||void 0===r?void 0:r.state,void 0,2),"`"]}),Object(g.jsxs)("div",{children:["drivers: ",o]}),Object(g.jsx)("audio",{id:"remoteAudio",autoPlay:!0,playsInline:!0})]}):Object(g.jsx)(C,{})})})},E=function(){return Object(g.jsxs)(w,{children:[Object(g.jsx)("h1",{children:"you are in the app"}),Object(g.jsx)(J,{})]})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,173)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))};u.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(E,{})}),document.getElementById("root")),P()},97:function(e,t,n){},99:function(e,t,n){}},[[157,1,2]]]);
//# sourceMappingURL=main.99e9d443.chunk.js.map